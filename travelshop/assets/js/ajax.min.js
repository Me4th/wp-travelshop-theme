jQuery(function($){function removeElement(array,elem){array.some(function(item){if(item["pm-id"]==elem){var index=array.indexOf(item);array.splice(index,1)}})}TSAjax=function(endpoint_url){var _this=this;this.endpoint_url=endpoint_url;if($(".js-range-slider").length>0){$(".js-range-slider").ionRangeSlider({input_values_separator:"-"})}this.call=function(query_string,scrollto,total_result_span_id){var jqxhr=$.ajax({url:this.endpoint_url+"?"+query_string,method:"GET",data:null}).done(function(data){for(var key in data.html){$("#"+key).html(data.html[key])}if(total_result_span_id!=null){var total_count_span=$(total_result_span_id);if(data.count==1){total_count_span.html(data.count+" "+total_count_span.data("total-count-singular"))}else if(data.count>1||data.count==0){total_count_span.html(data.count+" "+total_count_span.data("total-count-plural"))}else{total_count_span.html(total_count_span.data("total-count-default"))}}if(scrollto){$("html, body").animate({scrollTop:$(scrollto).offset().top},500)}if(!query_string.includes("wishlist")){window.history.pushState(null,"",window.location.pathname+"?"+query_string)}_this.wishlistEventListeners()}).fail(function(){console.log("ajax error")})};this.renderWishlist=function(){let wishlist=JSON.parse(window.localStorage.getItem("wishlist"));if(wishlist!==null&&wishlist.length!==0){let query_string="action=wishlist&pm-ot=607&view=Teaser2&pm-id=";$(".wishlist-count").text(wishlist.length);$(".wishlist-toggler").addClass("animate");setTimeout(function(){$(".wishlist-toggler").removeClass("animate")},1250);wishlist.forEach(function(item,key){if(key!==wishlist.length-1){query_string+=item["pm-id"]+","}else{query_string+=item["pm-id"]}});_this.call(query_string)}else{_this.wishlistEventListeners();$(".wishlist-count").text(0);$(".wishlist-items").html(`<p>Keine Reisen auf der Merkliste</p>`)}};this.wishlistEventListeners=function(){$(".remove-from-wishlist").click(function(e){let wishlist=JSON.parse(window.localStorage.getItem("wishlist"));if(!jQuery.isEmptyObject(wishlist)){if(wishlist.some(wi=>wi["pm-id"]==$(e.target).data("id"))){removeElement(wishlist,$(e.target).data("id"));$(".add-to-wishlist").each(function(key,item){if($(item).data("id")==$(e.target).data("id")){$(item).removeClass("active")}})}}window.localStorage.setItem("wishlist",JSON.stringify(wishlist));_this.renderWishlist()});if($(".add-to-wishlist").length>0){let wishlist=JSON.parse(window.localStorage.getItem("wishlist"));if(!jQuery.isEmptyObject(wishlist)){$(".add-to-wishlist").each(function(key,item){if(wishlist.some(wi=>wi["pm-id"]==$(item).data("id"))){$(item).addClass("active")}})}$(".add-to-wishlist").click(function(e){if(jQuery.isEmptyObject(wishlist)){wishlist=[]}if(wishlist.some(wi=>wi["pm-id"]==$(e.target).data("id"))){removeElement(wishlist,$(e.target).data("id"));$(e.target).removeClass("active")}else{wishlist.push({"pm-ot":"607","pm-id":$(e.target).data("id"),"pm-dr":$(e.target).data("daterange"),"pm-du":$(e.target).data("duration")});$(e.target).addClass("active")}window.localStorage.setItem("wishlist",JSON.stringify(wishlist));_this.renderWishlist()})}};this.pagination=function(){$("#search-result").on("click",".page-link",function(e){var href=$(this).attr("href").split("?");var query_string=href[1];_this.call(query_string,"#search-result");e.preventDefault()})};this.buildSearchQuery=function(form){var query=[];query.push("action=search");var id_object_type=$("input[name=pm-ot]").val();if(id_object_type&&id_object_type!=""){query.push("pm-ot="+id_object_type)}var selected=[];$(form).find(".category-tree input:checked").each(function(){var id_parent=$(this).data("id-parent");var id=$(this).data("id");var name=$(this).data("name");if(!selected[name]){selected[name]=[]}var i=selected[name].indexOf(id_parent);if(i>-1){selected[name].splice(i,1)}var i=selected[name].indexOf(id);if(i==-1){selected[name].push(id)}});var delimiter=",";var key;for(key in selected){query.push("pm-c["+key+"]="+selected[key].join(delimiter))}var price_range=$("input[name=pm-pr]").val();if(price_range&&price_range!=""){query.push("pm-pr="+price_range)}var date_range=$("input[name=pm-dr]").data("value");if(date_range&&date_range!=""){query.push("pm-dr="+date_range)}var search_term=$("input[name=pm-t]").val();if(search_term&&search_term!=""){query.push("pm-t="+search_term)}var order=$("select[name=pm-o]").val();if(order&&order!=""){query.push("pm-o="+order)}var query_string;query_string=query.join("&");return query_string};this.filter=function(){if($(window).width()>768){$("#search-filter").on("change",".list-filter-box input, .list-filter-box select",function(e){var form=$(this).closest("form");var query_string=_this.buildSearchQuery(form);_this.call(query_string,"#search-result");e.preventDefault()})}$("#search-filter").on("click",".list-filter-box-submit",function(e){var form=$(this).closest("form");var query_string=_this.buildSearchQuery(form);_this.call(query_string,"#search-result");e.preventDefault()})};this.searchbox=function(){$(".search-box input, .search-box  select").on("change",function(e){var form=$(this).closest("form");var query_string=_this.buildSearchQuery(form);var button=$(form).find("a.btn");var href=button.attr("href").split("?");button.attr("href",href[0]+"?"+query_string);var current_location=window.location.href.split("?");if(current_location[0]==href[0]){_this.call(query_string,undefined,".search-bar-total-count")}e.preventDefault()})}};var Search=new TSAjax("/wp-content/themes/travelshop/pm-ajax-endpoint.php");Search.renderWishlist();Search.pagination();Search.searchbox();Search.filter()});