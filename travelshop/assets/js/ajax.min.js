TSAjax=function(endpoint_url){var _this=this;this.endpoint_url=endpoint_url;if($(".js-range-slider").length>0){$(".js-range-slider").ionRangeSlider({input_values_separator:"-"})}this.call=function(query_string,scrollto,total_result_span_id){var jqxhr=$.ajax({url:this.endpoint_url+"?"+query_string,method:"GET",data:null}).done(function(data){for(var key in data.html){$("#"+key).html(data.html[key])}if(total_result_span_id!=null){var total_count_span=$(total_result_span_id);if(data.count==1){total_count_span.html(data.count+" "+total_count_span.data("total-count-singular"))}else if(data.count>1||data.count==0){total_count_span.html(data.count+" "+total_count_span.data("total-count-plural"))}else{total_count_span.html(total_count_span.data("total-count-default"))}}if(scrollto){$("html, body").animate({scrollTop:$(scrollto).offset().top},500)}window.history.pushState(null,"",window.location.pathname+"?"+query_string);addFilterCheckboxEventListener($("#filter"))}).fail(function(){console.log("ajax error")})};this.pagination=function(){$("#search-result").on("click",".page-link",function(e){var href=$(this).attr("href").split("?");var query_string=href[1];_this.call(query_string,"#search-result");e.preventDefault()})};this.buildSearchQuery=function(form){var query=[];var id_object_type=$("input[name=pm-ot]").val();if(id_object_type&&id_object_type!=""){query.push("pm-ot="+id_object_type)}var selected=[];$(form).find(".category-tree input:checked").each(function(){var id_parent=$(this).data("id-parent");var id=$(this).data("id");var name=$(this).data("name");if(!selected[name]){selected[name]=[]}var i=selected[name].indexOf(id_parent);if(i>-1){selected[name].splice(i,1)}var i=selected[name].indexOf(id);if(i==-1){selected[name].push(id)}});var delimiter=",";var key;for(key in selected){query.push("pm-c["+key+"]="+selected[key].join(delimiter))}var price_range=$("input[name=pm-pr]").val();if(price_range&&price_range!=""){query.push("pm-pr="+price_range)}var date_range=$("input[name=pm-dr]").data("value");if(date_range&&date_range!=""){query.push("pm-dr="+date_range)}var search_term=$("input[name=pm-t]").val();if(search_term&&search_term!=""){query.push("pm-t="+search_term)}var order=$("select[name=pm-o]").val();if(order&&order!=""){query.push("pm-o="+order)}var query_string;query_string=query.join("&");return query_string};this.filter=function(){if($(window).width()>768){$("#search-filter").on("change",".list-filter-box input, .list-filter-box select",function(e){var form=$(this).closest("form");var query_string=_this.buildSearchQuery(form);_this.call(query_string,"#search-result");e.preventDefault()})}$("#search-filter").on("click",".list-filter-box-submit",function(e){var form=$(this).closest("form");var query_string=_this.buildSearchQuery(form);_this.call(query_string,"#search-result");e.preventDefault()})};this.searchbox=function(){$(".search-box input, .search-box  select").on("change",function(e){var form=$(this).closest("form");var query_string=_this.buildSearchQuery(form);var button=$(form).find("a.btn");var href=button.attr("href").split("?");button.attr("href",href[0]+"?"+query_string);var current_location=window.location.href.split("?");if(current_location[0]==href[0]){_this.call(query_string,undefined,".search-bar-total-count")}e.preventDefault()})}};var Search=new TSAjax("/wp-content/themes/travelshop/pm-ajax-endpoint.php");Search.pagination();Search.searchbox();Search.filter();